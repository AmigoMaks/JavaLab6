import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import java.awt.*;
import java.io.File;
import java.io.FileNotFoundException;
import java.util.InputMismatchException;
import java.util.Scanner;

class ZeroSumException extends ArithmeticException {
    public ZeroSumException(String message) {
        super(message);
    }
}

public class Main extends JFrame {

    private final JTextField filePathField;
    private final JButton loadButton;
    private final JTable matrixTable;
    private final DefaultTableModel tableModel;
    private final JLabel resultLabel;
    private final JPanel topPanel, bottomPanel;

    public Main() {
        setTitle("Matrix Analyzer");
        setSize(600, 500);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLayout(new BorderLayout());
        setLocationRelativeTo(null);

        topPanel = new JPanel();
        topPanel.add(new JLabel("File Path:"));
        
        filePathField = new JTextField("input.txt", 20);
        topPanel.add(filePathField);

        loadButton = new JButton("Load & Calculate");
        topPanel.add(loadButton);

        add(topPanel, BorderLayout.NORTH);

        tableModel = new DefaultTableModel();
        matrixTable = new JTable(tableModel);
        JScrollPane scrollPane = new JScrollPane(matrixTable);
        add(scrollPane, BorderLayout.CENTER);

        bottomPanel = new JPanel();
        resultLabel = new JLabel("Result: Please load a file.");
        bottomPanel.add(resultLabel);
        add(bottomPanel, BorderLayout.SOUTH);

        loadButton.addActionListener(e -> processFile());
    }

    private void processFile() {
        String filePath = filePathField.getText();
        File file = new File(filePath);

        tableModel.setRowCount(0);
        tableModel.setColumnCount(0);
        resultLabel.setText("Processing...");
        resultLabel.setForeground(Color.BLACK);

        try (Scanner sc = new Scanner(file)) {
            
            if (!sc.hasNextInt()) {
                throw new InputMismatchException("File is empty or format is wrong.");
            }
            int n = sc.nextInt();

            if (n > 20 || n <= 0) {
                JOptionPane.showMessageDialog(this, "N must be > 0 and <= 20", "Input Error", JOptionPane.ERROR_MESSAGE);
                return;
            }

            int[][] M = new int[n][n];
            tableModel.setColumnCount(n);
            
            for (int i = 0; i < n; i++) {
                Object[] rowData = new Object[n];
                for (int j = 0; j < n; j++) {
                    if (sc.hasNextInt()) {
                        int val = sc.nextInt();
                        M[i][j] = val;
                        rowData[j] = val;
                    } else {
                        throw new InputMismatchException("Not enough integers in file for matrix " + n + "x" + n);
                    }
                }
                tableModel.addRow(rowData);
            }

            int[] rowSums = new int[n];
            int[] colSums = new int[n];

            for (int i = 0; i < n; i++) {
                int sum = 0;
                for (int j = 0; j < n; j++) {
                    sum += M[i][j];
                }
                rowSums[i] = sum;
                
                if (sum == 0) {
                    throw new ZeroSumException("Row " + (i + 1) + " sum is ZERO. This is not allowed!");
                }
            }

            for (int j = 0; j < n; j++) {
                int sum = 0;
                for (int i = 0; i < n; i++) {
                    sum += M[i][j];
                }
                colSums[j] = sum;
            }

            StringBuilder matches = new StringBuilder("Matches found\n:");
            boolean found = false;

            for (int i = 0; i < n; i++) {
                for (int j = 0; j < n; j++) {
                    if (rowSums[i] == colSums[j]) {
                        matches.append("Row ").append(i + 1)
                               .append(" == Col ").append(j + 1)
                               .append(" (Sum: ").append(rowSums[i]).append(")\n");
                        found = true;
                    }
                }
            }
            matches.append("");

            if (found) {
                resultLabel.setText(matches.toString());
                resultLabel.setForeground(new Color(0, 100, 0));
            } else {
                resultLabel.setText("No row and column sums match.");
                resultLabel.setForeground(Color.BLUE);
            }

        } catch (FileNotFoundException ex) {
            JOptionPane.showMessageDialog(this, "File not found", "Error", JOptionPane.ERROR_MESSAGE);
            resultLabel.setText("Error: File not found.");
        } catch (InputMismatchException ex) {
            JOptionPane.showMessageDialog(this, "Invalid data format in file", "Data Error", JOptionPane.ERROR_MESSAGE);
            resultLabel.setText("Error: Invalid file format.");
        } catch (ZeroSumException ex) {
            JOptionPane.showMessageDialog(this, ex.getMessage(), "Arithmetic Logic Error", JOptionPane.WARNING_MESSAGE);
            resultLabel.setText("Stopped due to ZeroSumException.");
            resultLabel.setForeground(Color.RED);
        } catch (Exception ex) {
            ex.printStackTrace();
            JOptionPane.showMessageDialog(this, "An unexpected error occurred: " + ex.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
        }
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(() -> new Main().setVisible(true));
    }
}
